<?php
/** @var    Swissbib\RecordDriver\SolrMarc $record */
/** @var    VuFind\View\Helper\Root\Record $viewRecord */
$record = $this->driver;
$viewRecord = $this->record($this->driver);
$thumbnail = $viewRecord->getThumbnail('small');
$thumbnailSrc = $thumbnail ? $thumbnail : $this->url('cover-unavailable');
$detailLink = $this->recordLink()->getUrl($record);
$titleStatement = $record->getTitleStatement(true);
$shortTitle = $record->getShortTitle();
$subtitle = $viewRecord->getSubtitle($titleStatement);
$responsible = $viewRecord->getResponsible($titleStatement, $record);
$edition = $record->getEdition();
$summDate= $record->getHumanReadablePublicationDates();
$hostitems = $record->getHostItemEntry();
$journalTitle = $record->getContainerTitle();
$groupID = $record->getGroup(true);
$uniqueID = $record->getUniqueID();
$showFRBR = $this->configAccess()->Site->displayFrbr;
$memorizeLink = $this->recordLink()->getActionUrl($this->driver, 'Save');
?>

<div class="<?=$this->driver->supportsAjaxStatus()?'ajaxItem ':''?>col-xs-11 gutter-1">
  <input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getUniqueID())?>" class="hiddenId" />
  <input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getResourceSource())?>" class="hiddenSource" />

  <div class="hidden-xs col-sm-3 col-md-2 no-gutter">
    <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="img-responsive">
        <img class="recordcover" src="<?= $thumbnailSrc ?>"/>
    </a>
  </div>

  <!-- Kurztitel (vorher class="col-xs-7 col-sm-8 col-md-7" -->
  <div class="col-xs-10 col-sm-8 col-md-7">
    <div>
        <h2>
            <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="title" title="<?= $this->escapeHtml($shortTitle) ?>">
                <?= $this->escapeHtml($shortTitle) ?>
            </a>
        </h2>
    </div>

    <!-- Untertitel und Verfasserangabe -->
    <div class="meta">
       <? if (isset($subtitle)): ?>
        <?= $this->escapeHtml($subtitle) ?><br />
       <? endif; ?>
        <? if ($responsible): ?>
            <span class="hidden-xs label"><strong><?= $this->transEsc('Author') ?>:</strong></span>
            <span>
               <?= $this->escapeHtml($responsible) ?>
            </span><br />
        <? endif; ?>
    </div>

    <!-- Zeitschriftentitel, Erscheinungsjahr -->
    <div class="meta">
        <? if ($hostitems): ?>
            <? foreach ($hostitems as $hostitem): ?>
                <span class="hidden-xs label"><strong><?= $this->transEsc('note_773') ?>:</strong></span>
                <? $text = array_key_exists('related', $hostitem) ? $hostitem['title'] . ', ' . $hostitem['related'] : $hostitem['title'] ?>
                <span><?= $this->escapeHtml($text) ?></span><br />
            <? endforeach; ?>
        <? endif; ?>
        <? if ($journalTitle): ?>
            <span class="hiddex-xs label"><strong><?= $this->transEsc('Published in')?>:</strong></span>
            <span><a href="<?= $viewRecord->getLink('journaltitle', $journalTitle)?>"><?= $this->escapeHtml($journalTitle)?></a></span><br />
        <? endif; ?>
        <? if ($summDate): ?>
        <span class="hidden-xs label"><strong><?= $this->transEsc('Year') ?>:</strong></span>
        <span><?= $this->escapeHtml($summDate[0]) ?></span><br />
        <? endif; ?>
        <? if ($edition): ?>
             <span class="hidden-xs label"><strong><?= $this->transEsc('Edition') ?>:</strong></span>
             <span><?= $this->escapeHtml($edition) ?></span><br />
        <? endif; ?>
    </div>
    <?=str_replace('class="', 'class="label label-info ', $this->record($this->driver)->getFormatList())?>
  </div>

  <div class="col-xs-1 col-md-3 hidden-print">
    <div class="btn-group-vertical">
        <? if ($this->userlist()->getMode() !== 'disabled'): ?>
          <a href="<?= $this->recordLink()->getActionUrl($this->driver, 'Save'); ?>" class="btn btn-default" title="<?= $this->transEsc('memorizelistadd') ?>">
              <i class="fa fa-heart"></i>
              <?= $this->transEsc('memorizelistadd') ?>
          </a>
          <? /* Saved lists */ ?>
          <div class="savedLists alert alert-info hidden">
            <strong><?=$this->transEsc("Saved in")?>:</strong>
          </div>
        <? endif; ?>

        <? /* Hierarchy tree link */ ?>
        <? $trees = $this->driver->tryMethod('getHierarchyTrees'); if (!empty($trees)): ?>
          <? foreach ($trees as $hierarchyID => $hierarchyTitle): ?>
              <input type="hidden" value="<?=$this->escapeHtmlAttr($hierarchyID)?>" class="hiddenHierarchyId" />

              <a class="btn btn-default <?=$viewRecord->getTabVisibility('HierarchyTree')?>" href="<?=$this->recordLink()->getTabUrl($this->driver, 'HierarchyTree')?>?hierarchy=<?=urlencode($hierarchyID)?>#tabnav" title="<?=$this->transEsc('hierarchy_tree')?>">
                <i class="fa fa-sitemap"></i>
                <span class="hidden-xs"> <?=$this->transEsc('hierarchy_view_context')?>
                    <? if (count($trees) > 1): ?>:
                      <?=$this->escapeHtml($hierarchyTitle)?>
                    <? endif; ?>
                </span>
              </a>
          <? endforeach; ?>
      <? endif; ?>

      <? if (!empty($showFRBR) && $showFRBR && !empty($groupID) && !strcmp($results->getParams()->getSearchHandler(), 'FRBR') == 0) : ?>
        <a href="<?= $this->url('search-results') . '?lookfor=' . $groupID . "&type=FRBR&limit=" . $results->getParams()->getLimit() . "&sort=publishDateSort+desc" ?>"
              class="btn-frbr btn btn-default" title="<?= $this->transEsc('FRBR_Button') ?>">
          <i class="fa fa-eye"></i>
          <span class="hidden-xs"><?= $this->transEsc('FRBR_Button') ?></span>
        </a>
      <? endif; ?>

      <? if ($this->driver->displayHoldings()): ?>
        <?= $this->render('search/results/available.phtml') ?>
        <?= $this->render('search/results/libraries.phtml') ?>
      <? endif; ?>

      <? if ($this->isFavoriteInstitution($record->getInstitutions())): ?>
          <img src="<?= $this->basePath('themes/swissbib/images/icon_favorit_library.gif') ?>"
                 alt="Favourite library icon (heart)" class="favourite-library">
      <? endif; ?>
    </div>
  </div>
    <!-- COINS -->
    <span class="Z3988" title="<?= $this->escapeHtml($record->getOpenURL()) ?>"></span>
</div>