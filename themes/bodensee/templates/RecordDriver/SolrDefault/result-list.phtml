<?php     
    $hasSubRecords = $this->driver->hasSubRecords();
    $subRecords = $this->driver->getSubRecords();
    $subRecordsCount = 0;
    if ($subRecords) {
        $subRecordsCount = sizeof($subRecords);
    }
    $isSubRecord = $this->driver->isSubRecord();
    $uniqueId = $this->driver->getUniqueId();

    $hiddenFilters = $this->searchMemory()->getLastHiddenFilters($this->searchClassId);
    $hiddenFilterString = '';
    foreach ($hiddenFilters as $key => $filter) {
        foreach ($filter as $value) {
            $hiddenFilterString .= '&hiddenFilters[]=' . $this->escapeHtmlAttr($key) . ':' . $this->escapeHtmlAttr($value);
        }
    }
?>
<?
    $coverDetails = $this->record($this->driver)->getCoverDetails('result-list', 'medium', $this->recordLink()->getUrl($this->driver));
    $cover = $coverDetails['html'];
    $thumbnail = false;
    $thumbnailAlignment = $this->record($this->driver)->getThumbnailAlignment('result');?>
    <? if ($cover): ?>
        <? ob_start(); ?>
        <div class="hidden-print media-<?=$thumbnailAlignment ?> <?=$this->escapeHtmlAttr($coverDetails['size'])?>">
            <?=$cover ?>
        </div>
        <? $thumbnail = ob_get_contents(); ?>
        <? ob_end_clean(); ?>
    <? else: ?>
        <div class="hidden-print recordcover unavailable <?=$this->mapper()->mapIcon($this->driver->getFormats())?>">     
            <span class=""></span>
        </div>
    <? endif; ?>

<input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getUniqueID())?>" class="hiddenId" />
<input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getSourceIdentifier())?>" class="hiddenSource" />
<div class="media ">
    <? if ($thumbnail && $thumbnailAlignment == 'left'): ?>
        <?=$thumbnail ?>
    <? endif ?>
    <div class="media-body">
        <div class="result-body">
            <div>
                <?=$this->render('RecordDriver/SolrDefault/parts/dedup-tooltip.phtml', ['driver' => $this->driver])?>  
                <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="title getFull" data-view="<?=$this->params->getOptions()->getListViewOption() ?>">
                    <?=$this->record($this->driver)->getTitleHtml()?>
                </a>
            </div>
            
            <?=$this->render('RecordDriver/SolrDefault/parts/author.phtml', [
                               'driver' => $this->driver,
                               'hiddenFilterString' => $hiddenFilterString])?>  
            
            <? if(!$this->driver->isCollection()): ?>
              <? if ($snippet = $this->driver->getHighlightedSnippet()): ?>
                <? if (!empty($snippet['caption'])): ?>
                  <strong><?=$this->transEsc($snippet['caption']) ?>:</strong> ';
                <? endif; ?>
                <? if (!empty($snippet['snippet'])): ?>
                  <span class="quotestart">&#8220;</span>...<?=$this->highlight($snippet['snippet']) ?>...<span class="quoteend">&#8221;</span><br/>
                <? endif; ?>
              <? endif; ?>
            <? endif; ?>
                  
            <? /* Display information on duplicate records if available */?>
            <? if ($dedupData = $this->driver->getDedupData()): ?>
                <div class="dedupInformation">
                <? $i = 0 ?>
                <? foreach ($dedupData as $source => $current): ?>
                    <? if (++$i == 1):?>
                    <span class="currentSource"><a href="<?=$this->recordLink()->getUrl($this->driver)?>"><?=$this->transEsc("source_$source", [], $source)?></a></span>
                    <? else: ?>
                        <? if ($i == 2): ?>
                            <span class="otherSources">(<?=$this->transEsc('Other Sources')?>: 
                        <? else: ?>, 
                        <? endif; ?>
                        <a href="<?=$this->recordLink()->getUrl($current['id'])?>"><?=$this->transEsc("source_$source", [], $source)?></a>
                    <? endif; ?>
                <? endforeach; ?>
                <? if ($i > 1): ?>
                     )</span>
                <? endif; ?>
                </div>
             <? endif; ?>
        </div>
    </div>
</div>
  