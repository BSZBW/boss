<?php     
    $hasSubRecords = $this->driver->hasSubRecords();
    $subRecords = $this->driver->getSubRecords();
    $subRecordsCount = 0;
    if ($subRecords) {
        $subRecordsCount = sizeof($subRecords);
    }
    $isSubRecord = $this->driver->isSubRecord();
    $uniqueId = $this->driver->getUniqueId();

    $hiddenFilters = $this->searchMemory()->getLastHiddenFilters($this->searchClassId);
    $hiddenFilterString = '';
    foreach ($hiddenFilters as $key => $filter) {
        foreach ($filter as $value) {
            $hiddenFilterString .= '&hiddenFilters[]=' . $this->escapeHtmlAttr($key) . ':' . $this->escapeHtmlAttr($value);
        }
    }
?>
<?
    $coverDetails = $this->record($this->driver)->getCoverDetails('result-list', 'medium', $this->recordLink()->getUrl($this->driver));
    $cover = $coverDetails['html'];
    $thumbnail = false;
    $thumbnailAlignment = $this->record($this->driver)->getThumbnailAlignment('result');?>
    <? if ($cover): ?>
        <? ob_start(); ?>
        <div class="hidden-print media-<?=$thumbnailAlignment ?> <?=$this->escapeHtmlAttr($coverDetails['size'])?>">
            <?=$cover ?>
        </div>
        <? $thumbnail = ob_get_contents(); ?>
        <? ob_end_clean(); ?>
    <? else: ?>
        <div class="hidden-print recordcover unavailable <?=$this->mapper()->mapIcon($this->driver->getFormats())?>">     
            <span class=""></span>
        </div>
    <? endif; ?>

<input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getUniqueID())?>" class="hiddenId" />
<input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getSourceIdentifier())?>" class="hiddenSource" />
<div class="media">
    <? if ($thumbnail && $thumbnailAlignment == 'left'): ?>
        <?=$thumbnail ?>
    <? endif ?>
    <div class="media-body">
        <div class="result-body">
            <div>
                <?=$this->render('RecordDriver/SolrDefault/parts/dedup-tooltip.phtml', ['driver' => $this->driver])?>  
                <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="title getFull" data-view="<?=$this->params->getOptions()->getListViewOption() ?>">
                    <?=$this->record($this->driver)->getTitleHtml()?>
                </a>
            </div>
            
            <?=$this->render('RecordDriver/SolrDefault/parts/author.phtml', [
                               'driver' => $this->driver,
                               'hiddenFilterString' => $hiddenFilterString])?>  
            
            <? if(!$this->driver->isCollection()): ?>
              <? if ($snippet = $this->driver->getHighlightedSnippet()): ?>
                <? if (!empty($snippet['caption'])): ?>
                  <strong><?=$this->transEsc($snippet['caption']) ?>:</strong> ';
                <? endif; ?>
                <? if (!empty($snippet['snippet'])): ?>
                  <span class="quotestart">&#8220;</span>...<?=$this->highlight($snippet['snippet']) ?>...<span class="quoteend">&#8221;</span><br/>
                <? endif; ?>
              <? endif; ?>
            <? endif; ?>
                  
            <? /* Display information on duplicate records if available */?>
            <? if ($dedupData = $this->driver->getDedupData()): ?>
                <div class="dedupInformation">
                <? $i = 0 ?>
                <? foreach ($dedupData as $source => $current): ?>
                    <? if (++$i == 1):?>
                    <span class="currentSource"><a href="<?=$this->recordLink()->getUrl($this->driver)?>"><?=$this->transEsc("source_$source", [], $source)?></a></span>
                    <? else: ?>
                        <? if ($i == 2): ?>
                            <span class="otherSources">(<?=$this->transEsc('Other Sources')?>: 
                        <? else: ?>, 
                        <? endif; ?>
                        <a href="<?=$this->recordLink()->getUrl($current['id'])?>"><?=$this->transEsc("source_$source", [], $source)?></a>
                    <? endif; ?>
                <? endforeach; ?>
                <? if ($i > 1): ?>
                     )</span>
                <? endif; ?>
                </div>
            <? endif; ?>
            <? $edition = $this->driver->getEdition(); if (!empty($edition)): ?>
                <div>
                    <strong><?=$this->transEsc('Edition')?>: </strong>
                    <span property="bookEdition"><?=$this->escapeHtml($edition)?></span>          
                </div>      
            <? endif; ?>
            <? if( $this->searchTabs()->isILL() && strlen($this->driver->getConsortium()) > 0): ?>
                <div class="ill-source">                
                    <strong><?=$this->transEsc('Network')?>:</strong>
                    <span><?=$this->driver->getConsortium() ?></span> 
                </div>          
            <? endif; ?>   
            <?=$this->render('RecordDriver/SolrDefault/parts/links.phtml', [
                'driver' => $this->driver,
                'hiddenFilterString' => $hiddenFilterString])?>   
                  
            <div class="callnumAndLocation ajax-availability hidden">
                <? if ($this->driver->supportsAjaxStatus()): ?>
                    <strong class="hideIfDetailed"><?=$this->transEsc('Call Number')?>:</strong>
                    <span class="callnumber ajax-availability hidden">
                        <?=$this->transEsc('Loading')?>...<br/>
                    </span>
                    <strong><?=$this->transEsc('Located')?>:</strong>
                    <span class="location ajax-availability hidden">
                        <?=$this->transEsc('Loading')?>...
                    </span>
                    <div class="locationDetails"></div>
                <? endif; ?>
            </div>
            <div class="result-formats">
                <?=$this->record($this->driver)->getFormatList() ?>
                <? if (empty($urls) && $this->driver->supportsAjaxStatus()): ?>
                    <span class="status ajax-availability hidden">
                        <span class="label label-default"><?=$this->transEsc('Loading')?>...</span>
                    </span>   
                <? endif; ?>
            </div>
            <div class="result-previews">
                <?=$this->record($this->driver)->getPreviews()?>
            </div>
        </div> <!-- end result-body -->
    </div> <!-- end media-body -->
</div> <!-- end media -->
  